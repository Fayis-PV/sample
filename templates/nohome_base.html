{% load static %}


<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <meta http-equiv="cache-control" content="no-cache" />
      <!-- site metas -->
      <title>{% block title %}{% endblock title %} | C-L-A</title>
      <meta name="keywords" content="Django Python E-website Sample">
      <meta name="description" content="">
      <meta name="author" content="Muhammed Fayis PV">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
      <!-- style css -->
      <link rel="stylesheet" href="{% static 'css/style.css' %}">
      <!-- Responsive-->
      <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
      <!-- fevicon -->
      <link rel="icon" href="{% static 'images/fevicon.png' %}" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="{% static 'css/jquery.mCustomScrollbar.min.css' %}">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
   </head>
   <!-- body -->
   <body class="main-layout inner_posituong computer_page">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="{% static 'images/loading.gif' %}" alt="#" /></div>
      </div>
      <!-- end loader -->
      <!-- header -->
      <header>
         <!-- header inner -->
         <div class="header">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <div class="logo">
                              <a href="{% url 'cla:index' %}"><img src="{% static 'images/logo.png' %}" alt="#" /></a>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                     <nav class="navigation navbar navbar-expand-md navbar-dark ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExample04">
                           <ul class="navbar-nav mr-auto">
                              <!-- <li class="nav-item active">
                                 <a class="nav-link" href="{% url 'cla:index' %}">Home</a>
                              </li> -->
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'cla:about' %}">About</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'cla:cart' %}">Cart <span class="badge badge-light mb-1" id="count" value="{{count}}">{{count}}</span></a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'cla:product' %}">Products</a>
                                 <!-- <ul>
                                    <li class="">
                                       <a class="nav-link" href="{% url 'cla:computer' %}">Computer</a>
                                    </li>
                                    <li class="">
                                       <a class="nav-link" href="{% url 'cla:laptop' %}">Laptop</a>
                                    </li>
                                 </ul> -->
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'cla:contact' %}">Contact Us</a>
                              </li>
                              
                              {% if user.is_authenticated %}
                              <li class="nav-item">
                                 <h4 class="nav-text" style=" padding: 0 25p;color: rgb(90, 220, 249);font-size: 14px;line-height: 20px;font-weight: 500;">Hello, {{user.first_name}} <br>{{user.last_name}}</h4>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" id="confirm-logout" href="{% url 'accounts:logout' %}" onclick="return confirm('Are you sure you want to Logout?')">Logout</a>
                              </li>
                              {% else %}
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'accounts:login' %}">Login</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="{% url 'accounts:register' %}">Register</a>
                              </li>
                              {% endif %}
                              <li class="nav-item d_none">
                                 <a class="nav-link" href="#"><i class="fa fa-search" aria-hidden="true"></i></a>
                              </li>
                              
                           </ul>
                        </div>
                     </nav>
                  </div>
               </div>
            </div>
         </div>
      </header>
      <!-- end header inner -->
      <!-- end header -->
      {% block content %} 


      {% endblock %}
      <!--  footer -->
      <footer>
         <div class="footer">
            <div class="container">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <img class="logo1" src="{% static 'images/logo1.png' %}" alt="#"/>
                     <ul class="social_icon">
                        <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-linkedin-square" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>About Us</h3>
                     <ul class="about_us">
                        <li>dolor sit amet, consectetur<br> magna aliqua. Ut enim ad <br>minim veniam, <br> quisdotempor incididunt r</li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>Contact Us</h3>
                     <ul class="conta">
                        <li>dolor sit amet,<br> consectetur <br>magna aliqua.<br> quisdotempor <br>incididunt ut e </li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <form class="bottom_form">
                        <h3>Newsletter</h3>
                        <input class="enter" placeholder="Enter your email" type="email" name="subscribe_email">
                        <button class="sub_btn">subscribe</button>
                     </form>
                  </div>
               </div>
            </div>
            <div class="copyright">
               <div class="container">
                  <div class="row">
                     <div class="col-md-12">
                        <p>Â© 2019 All Rights Reserved. Design by<a href="{% static 'https://html.design/' %}"> Free Html Templates</a></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </footer>
      <!-- end footer -->
      <!-- Javascript files-->
      {% block script %}
      {% endblock script %}
      <script src="{% static 'js/jquery.min.js' %}"></script>
      <script src="{% static 'js/popper.min.js' %}"></script>
      <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
      <script src="{% static 'js/jquery-3.0.0.min.js' %}"></script>
      <!-- sidebar -->
      <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
      <script src="{% static 'js/custom.js' %}"></script>
      
      <script type="text/javascript">
         var user = '{{request.user}}'
         
         function getToken(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getToken('csrftoken');
         
      </script>
      <script>
         var updateData = document.getElementsByClassName('update-data')
       
                for(var i = 0;i<updateData.length;i++){
                   updateData[i].addEventListener('click',function(){
                      var productId = this.dataset.product
                      var action = this.dataset.action
                      var url = this.dataset.url
                      var itemQuantity = document.getElementById(productId)
                      var cardId = 'card-'+productId
                      var getCardId = document.getElementById(cardId)
                     // check()

                      console.log('productId: ' , productId, 'action: ',action,'url:',url)
                      console.log('User: ' ,user) 
                      if(user == 'AnonymousUser'){
                        console.log("Not logged In")
                        UserLogin()
                      }else{
                        console.log('Logged In ...')
                        updateUserOrder(productId,action,url,itemQuantity,getCardId)
         
                      }
                      
                   })
                   
                 }
                 function updateUserOrder(productId,action,url,itemQuantity,getCardId){
                  var countBadge = document.getElementById('count')
                  var itemsCount = document.getElementById('items-count')
                  var allTotal = document.getElementById('all-total')

                  var itemQuantity =itemQuantity
                  var url = url
                  fetch(url,
                  {
                        method: 'POST',
                        headers: {
                           'Content-Type': 'application/json',
                           'X-CSRFToken': csrftoken
                        },
                      //  mode: 'same-origin', // Do not send CSRF token to another domain.
                        body : JSON.stringify({'productId':productId,'action':action}),
                     }
                  )
                  .then((response)=>{
                     return response.json()
                  })
                  .then((data)=>{
                     console.log('Data: ',data)
                     counts = data.counts
                     quantity = data.quantity
                     all_total = data.all_total
                     item_quantity = data.item_quantity
                     items_count = data.items_count
                     console.log('counts:',counts,
                     'all_total:',all_total,
                     'items_count:',items_count,
                     'item-quantity:',item_quantity
                     )
                     allTotal.innerHTML = all_total
                     
                   //  itemQuantity.innerHTML =item_quantity
                     itemsCount.innerHTML = items_count
                     console.log("0<",item_quantity)
                     if(item_quantity <= 0){
                        console.log('itemQuantityif:',item_quantity)
                        getCardId.className = 'd-none'}
                     else{itemQuantity.value = item_quantity}
                     countBadge.innerHTML = counts
                   //  location.reload()

                  }
                  ).catch((err)=>{
                     console.log(err)
                  })

               }

               function UserLogin(){
                  url = '/register/login'
                  fetch(url,
                  {
                     method : 'GET',
               }).then((response)=>{
                  console.log(response)
               })
               .then((data)=>{
                  console.log(data)
               }).catch((err)=>{
                  console.log(err)
               })
               }
       </script>
      
   </body> 
</html>